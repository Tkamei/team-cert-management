<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ¼ãƒ è³‡æ ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ãƒ‡ãƒ¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .navbar {
            background-color: #343a40;
            color: white;
            padding: 1rem 0;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .navbar h1 {
            text-align: center;
            margin: 0;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .login-section {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        
        .api-section {
            background-color: #f3e5f5;
            border-left: 4px solid #9c27b0;
        }
        
        .data-section {
            background-color: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="navbar">
            <h1>ãƒãƒ¼ãƒ è³‡æ ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - API ãƒ‡ãƒ¢</h1>
        </div>
        
        <div class="grid">
            <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="card login-section">
                <h2>ğŸ” èªè¨¼</h2>
                <div class="form-group">
                    <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="email" class="form-control" value="admin@demo.com">
                </div>
                <div class="form-group">
                    <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="password" class="form-control" value="admin123">
                </div>
                <button class="btn btn-primary" onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <button class="btn btn-secondary" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                <button class="btn btn-secondary" onclick="checkSession()">ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª</button>
                
                <div class="form-group" style="margin-top: 20px;">
                    <small>
                        <strong>ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:</strong><br>
                        ç®¡ç†è€…: admin@demo.com / admin123<br>
                        ãƒ¡ãƒ³ãƒãƒ¼: member@demo.com / member123
                    </small>
                </div>
            </div>
            
            <!-- APIãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="card api-section">
                <h2>ğŸ”§ API ãƒ†ã‚¹ãƒˆ</h2>
                <button class="btn btn-primary" onclick="getCertifications()">è³‡æ ¼ä¸€è¦§å–å¾—</button>
                <button class="btn btn-primary" onclick="getUsers()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—</button>
                <button class="btn btn-primary" onclick="getMyPlans()">è‡ªåˆ†ã®å­¦ç¿’è¨ˆç”»</button>
                <button class="btn btn-primary" onclick="getMyAchievements()">è‡ªåˆ†ã®å–å¾—å±¥æ­´</button>
                <button class="btn btn-primary" onclick="getNotifications()">é€šçŸ¥ä¸€è¦§</button>
                <button class="btn btn-secondary" onclick="healthCheck()">ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</button>
            </div>
            
            <!-- ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="card data-section">
                <h2>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h2>
                <div id="systemInfo">
                    <p><strong>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼:</strong> http://localhost:3000</p>
                    <p><strong>API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:</strong> http://localhost:3000/api</p>
                    <p><strong>ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯:</strong> http://localhost:3000/health</p>
                </div>
                <button class="btn btn-primary" onclick="getSystemStatus()">ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª</button>
            </div>
        </div>
        
        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="card">
            <h2>ğŸ“‹ å®Ÿè¡Œçµæœ</h2>
            <div id="result" class="result">
ã“ã“ã«å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ä¸Šè¨˜ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦APIã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚
            </div>
        </div>
    </div>

    <script>
        let sessionId = null;
        
        function showResult(data, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${isError ? 'error' : 'success'}`;
            resultDiv.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
        }
        
        async function apiCall(url, options = {}) {
            try {
                const response = await fetch(url, {
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(sessionId && { 'Authorization': `Bearer ${sessionId}` }),
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${data.error?.message || 'Unknown error'}`);
                }
                
                return data;
            } catch (error) {
                throw error;
            }
        }
        
        async function login() {
            try {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                const data = await apiCall('/api/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                
                if (data.success) {
                    sessionId = data.data.sessionId;
                    showResult({
                        message: 'ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼',
                        user: data.data.user,
                        sessionId: sessionId
                    });
                } else {
                    throw new Error(data.error?.message || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showResult(`ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        async function logout() {
            try {
                const data = await apiCall('/api/auth/logout', {
                    method: 'POST'
                });
                
                sessionId = null;
                showResult('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
            } catch (error) {
                showResult(`ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        async function checkSession() {
            try {
                const data = await apiCall('/api/auth/validate');
                showResult({
                    message: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹',
                    user: data.data.user,
                    valid: data.data.valid
                });
            } catch (error) {
                showResult(`ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        async function getCertifications() {
            try {
                const data = await apiCall('/api/certifications');
                showResult({
                    message: 'è³‡æ ¼ä¸€è¦§å–å¾—æˆåŠŸ',
                    count: data.data.certifications.length,
                    certifications: data.data.certifications
                });
            } catch (error) {
                showResult(`è³‡æ ¼ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        async function getUsers() {
            try {
                const data = await apiCall('/api/users');
                showResult({
                    message: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—æˆåŠŸ',
                    count: data.data.users.length,
                    users: data.data.users.map(u => ({
                        id: u.id,
                        name: u.name,
                        email: u.email,
                        role: u.role
                    }))
                });
            } catch (error) {
                showResult(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        async function getMyPlans() {
            try {
                const data = await apiCall('/api/study-plans/my');
                showResult({
                    message: 'å­¦ç¿’è¨ˆç”»å–å¾—æˆåŠŸ',
                    count: data.data.plans.length,
                    plans: data.data.plans
                });
            } catch (error) {
                showResult(`å­¦ç¿’è¨ˆç”»å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        async function getMyAchievements() {
            try {
                const data = await apiCall('/api/achievements/my');
                showResult({
                    message: 'å–å¾—å±¥æ­´å–å¾—æˆåŠŸ',
                    count: data.data.achievements.length,
                    achievements: data.data.achievements
                });
            } catch (error) {
                showResult(`å–å¾—å±¥æ­´å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        async function getNotifications() {
            try {
                const data = await apiCall('/api/notifications');
                showResult({
                    message: 'é€šçŸ¥ä¸€è¦§å–å¾—æˆåŠŸ',
                    count: data.data.notifications.length,
                    notifications: data.data.notifications
                });
            } catch (error) {
                showResult(`é€šçŸ¥ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        async function healthCheck() {
            try {
                const data = await apiCall('/health');
                showResult({
                    message: 'ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æˆåŠŸ',
                    ...data
                });
            } catch (error) {
                showResult(`ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        async function getSystemStatus() {
            try {
                const healthData = await apiCall('/health');
                const certData = await apiCall('/api/certifications');
                const userData = await apiCall('/api/users');
                
                showResult({
                    message: 'ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèªæˆåŠŸ',
                    server: healthData,
                    statistics: {
                        totalCertifications: certData.data.certifications.length,
                        totalUsers: userData.data.users.length,
                        timestamp: new Date().toISOString()
                    }
                });
            } catch (error) {
                showResult(`ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showResult('ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚\nä¸Šè¨˜ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦APIã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚');
        });
    </script>
</body>
</html>